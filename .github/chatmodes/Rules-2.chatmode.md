---
description: 'Description of the custom chat mode.'
tools: [#codebase]
---
````md
---
applyTo: '**'
---

# Project context & coding rules

AI, следуй этим правилам при генерации кода, ответах и ревью.

## Общие принципы
- **Язык ответов:** русский.
- **Формат:** кратко и по делу. Дай **конкретное рабочее решение**, а не общие рассуждения.
- **Перед изменениями** всегда дай блок **«План»** (по пунктам), затем сразу **реализацию**.
- **Поясняй «зачем»**: после кода добавь 2–5 лаконичных тезисов, почему приняты такие решения.
- **Сам проверяй**: не проси «проверь». Валидируй типы, импорты, сборку, соответствие линтерам и архитектуре.
- **Линтер/форматирование:** уважай `.eslintrc`, `.prettierrc`, `.editorconfig`. Не меняй стиль без причины.
- **Зависимости:** не добавляй новые без необходимости. Если добавляешь — объясни зачем и укажи `pnpm add ...`.
- При неоднозначности — выбери наилучшее предположение и сделай **частичную реализацию** с пометками замены.

## Контекст проекта (Next.js + TS + FSD)
- **Данные:** Server Actions / `fetch` с кэшем (`revalidate`, `cache`); на клиенте — SWR/RTK Query по необходимости.
- **UI:** shadcn/ui + Tailwind (Radix). Изображения — `next/image`, шрифты — `next/font` (без внешних CDN шрифтов).
- **Архитектура:** Feature-Sliced Design (`app/`, `entities/`, `features/`, `widgets/`, `shared/`). Зависимости не «подтекают» между слоями.
- **Сборка/импорты:** абсолютные алиасы, **named exports**; barrel-импорты там, где это повышает DX.
- **Пакетный менеджер:** pnpm. **Runtime:** Bun (если не оговорено иначе).
- **Наблюдаемость:** Sentry для ошибок; Web Vitals (LCP/INP/CLS) и перф-бюджеты в CI.

## Правила для Next.js
- SEO: `generateMetadata` на страницах, OG/Twitter карточки, JSON-LD при уместности.
- i18n: не хардкодить строки; использовать словари, корректные `aria-label`/`alt`.
- Избегать клиентской логики в серверных компонентов без причины; тяжелые клиентские блоки — `dynamic()`.

## UI/UX и Accessibility
- База — компоненты shadcn/ui; избегай локальной «копипасты» их стилей.
- Клавиатурная навигация, видимые фокус-кольца; **skip-link** к основному контенту.
- Корректные роли и семантика: `<button>` для действий, `<a href>` для переходов.
- Контраст WCAG AA (обычный текст ≥ 4.5:1); кликабельные зоны ≥ 44×44 px.
- Изображения: содержательные `alt`; декоративные — `alt=""`.
- Формы: связка `label`↔`input`, `aria-invalid`, `aria-describedby`; понятные тексты ошибок.
- Живые регионы: тосты/лоадеры с `aria-live`/`role="status"`.
- Уважай `prefers-reduced-motion`, `prefers-contrast`, `prefers-color-scheme`.
- `<html lang="…">`, корректный `dir`, локализация дат/валют.

## Производительность (практика)
- **LCP-ресурс:** `next/image` с `priority`, корректным `sizes` и `width/height`; предзагрузка критичных шрифтов через `next/font`.
- Минимизируй Client Components; тяжелые блоки — `dynamic()` (+ `ssr: false` при уместности).
- Контроль бандла: избегай тяжёлых зависимостей; ESM + tree-shaking; общий JS-бюджет на роут.
- Снижай работу main-thread: мемо-селекторы Zustand, избегай лишних эффектов/ре-рендеров.
- Сети: Brotli, HTTP/2/3; `preconnect`/`dns-prefetch` к нужным источникам; `fetchPriority` для критичных.
- Данные: `revalidate`/`cache`, `noStore()` для персонализированных ответов; батчинг/стриминг ответа.
- Медиа: WebP/AVIF, превью/blur, размеры под контейнер; без огромных оригиналов.
- Третьи скрипты — отложенно (`next/script` с `strategy="lazyOnload"`) и только по необходимости.

## Lighthouse — целевые метрики
- **LCP** ≤ 2.5 s (идеал ≤ 2.0 s), **INP** < 200 ms, **CLS** < 0.1.
- **FCP** ≤ 1.8 s, **TTFB** ≤ 0.5 s.
- Бюджеты загрузки на роут (gzip): JS ≤ **170 KB**, CSS ≤ **50 KB**; hero-изображение ≤ **200 KB**.
- Ошибки консоли = 0; только HTTPS; нет mixed-content.

## SEO
- `generateMetadata`: `title`, `description`, `canonical`; OG/Twitter карточки.
- **Sitemap** и `robots.txt`; превью-окружения — `noindex`/`Disallow: /`.
- i18n: `hreflang` для языковых версий; один канонический URL на язык.
- Семантика: один `<h1>` на страницу, валидная иерархия заголовков.
- JSON-LD для сущностей (Organization, Course/Article и т.п.).
- Чистые URL-ы, единая политика со слэшами; отсутствие дублей.
- Внутренняя перелинковка; смысловые якоря; alt-тексты у изображений.
- Быстрые 404/500 и настроенные редиректы без 301-цепочек.

## Best Practices
- `target="_blank"` всегда с `rel="noopener noreferrer"`.
- Запрет прямого `innerHTML` (только с явной санацией).
- Внешние скрипты — через `next/script` с явной стратегией.
- Долгие кэши для статики: `Cache-Control: public, max-age=31536000, immutable`.
- Обработаны ошибки/пустые состояния/скелетоны; нет «мертвых» ссылок.
- Staging/preview — помечены `noindex`.

## Безопасность
- Не логируй секреты; ключи только из окружения.
- Валидация входных данных через Zod; не доверяй клиентским данным.
- Учитывай XSS/CSRF/Clickjacking (например, `rel="noopener"` для внешних ссылок).
- `dangerouslySetInnerHTML` — только с санацией.

## Тесты и контроль качества
- Логика — unit-тесты (Jest/Vitest); критичный UI — скриншот-регресс (Loki) по мере необходимости.
- Пиши минимальные, но полезные тесты на валидации/форматтеры/ключевые хелперы.

## Формат ответа от AI
### План
1. Краткий пошаговый план (3–7 пунктов).

### Изменения
- Показывай **пофайловые патчи** и указывай путь:
  ```ts
  // file: app/(marketing)/page.tsx
  export function Page() { … }
````

* Несколько файлов — несколько блоков. Новый файл помечай **new**, удалённый — **delete** (с коротким объяснением).

### Почему

* 2–5 маркеров: архитектура, перфоманс, DX, a11y, безопасность.

### Проверки

* Краткий чек-лист (линтер, типы, ручной сценарий).
* Если добавлены зависимости — команда установки `pnpm add …`.

## Конвенции кода

* Имена: папки/утилиты — `kebab-case`, компоненты — `PascalCase`, хуки — `useX.ts`.
* Не плодить `index.tsx` без нужды; при использовании — понятные barrel-экспорты.
* Стили: Tailwind-классы + `cn()`; инлайновые стили — только в редких случаях.
* Типы: предпочтительно `type` + `satisfies`; явные возвращаемые типы у публичных API.
* Ошибки — типизированные `Result`/`Error`-типы или совместимые с `ZodError`.

## Ревью изменений (чек-лист для AI)

* [ ] Пути/импорты корректны, алиасы существуют.
* [ ] Код компилируется в strict-режиме, нет `any` без причины.
* [ ] Линтер/Prettier проходят.
* [ ] Компоненты соответствуют слою FSD; нет «протечек» зависимостей.
* [ ] Нет регрессий по a11y/SEO (alt/label/meta/структура заголовков).
* [ ] Нет лишних ре-рендеров; мемоизация уместна.
* [ ] Новые публичные API кратко задокументированы в JSDoc.

## Как отвечать на вопросы/диагностику

* Если видишь баг — **сначала** укажи точную причину, **сразу** дай фикс как патч.
* Минимальный воспроизводимый пример — только если ускоряет понимание.
* Не придумывай несуществующие API; если чего-то нет — создай **минимальную реализацию** в рамках проекта.
